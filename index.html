<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Mission Control Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#27ae60">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #27ae60; --secondary: #2ecc71; --primary-shadow: #219150;
            --overdue: #e74c3c; --bg-gradient: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            --glass: rgba(255, 255, 255, 0.95); --text: #2d3436; --bg-main: #f0f2f5;
            --card-bg: #ffffff; --col-bg: #ebedef; --border: #dfe6e9;
            --cat-work: #0984e3; --cat-home: #6c5ce7; --cat-personal: #00b894; --cat-urgent: #d63031;
        }

        [data-theme="dark"] {
            --primary: #2ecc71; --secondary: #55efc4; --primary-shadow: #1b9e53;
            --bg-main: #121212; --card-bg: #1e1e1e; --text: #f5f6fa;
            --glass: rgba(30, 30, 30, 0.95); --col-bg: #252525; --border: #333333;
        }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg-main); margin: 0; color: var(--text); overflow-x: hidden; transition: 0.3s; }

        /* Status Indicator Styling */
        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 10px; margin-left: 5px; vertical-align: middle; }
        .online { background: #2ecc71; color: white; }
        .offline { background: #95a5a6; color: white; }

        .top-nav { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        .btn-header { padding: 8px 15px; border-radius: 12px; font-weight: 600; font-size: 12px; cursor: pointer; border: 2px solid; background: var(--card-bg); color: var(--text); border-color: var(--border); }
        #install-btn { background: #2d3436; color: white; display: none; }
        .logout-btn { color: var(--overdue); border-color: var(--overdue); }

        #auth-screen { display: flex; height: 100vh; width: 100%; background: var(--bg-gradient); flex-direction: column; align-items: center; justify-content: center; }
        .auth-card { background: var(--glass); padding: 40px; border-radius: 24px; width: 340px; text-align: center; }
        .auth-input { width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 12px; border: 2px solid var(--border); box-sizing: border-box; }
        .btn-login { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 12px; width: 100%; font-weight: 600; cursor: pointer; }

        #app-dashboard { display: none; padding: 20px; max-width: 1200px; margin: auto; padding-top: 80px; }
        .analytics-container { background: var(--card-bg); border-radius: 12px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .analytics-header { background: var(--primary); color: white; padding: 10px; text-align: center; border-radius: 12px 12px 0 0; }
        .analytics-content { display: flex; padding: 25px; align-items: flex-end; gap: 20px; }
        
        .chart-area { flex-grow: 1; display: flex; justify-content: space-around; align-items: flex-end; height: 150px; border-bottom: 2px solid var(--border); }
        .bar-track { width: 25px; background: var(--col-bg); border-radius: 10px 10px 0 0; position: relative; height: 100%; overflow: hidden; }
        .bar-done { width: 100%; position: absolute; bottom: 0; background: var(--primary); transition: height 0.6s; }

        .input-bar { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px; background: var(--card-bg); padding: 20px; border-radius: 20px; margin-bottom: 20px; }
        .board { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .col { background: var(--col-bg); padding: 15px; border-radius: 20px; min-height: 300px; }
        ul { list-style: none; padding: 0; }
        li { background: var(--card-bg); padding: 12px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; border-left: 5px solid var(--primary); }

        @media (max-width: 768px) { .board, .input-bar { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="splash-screen" style="position:fixed; inset:0; background:#fff; z-index:9999; display:flex; align-items:center; justify-content:center; transition:0.5s;">
        <h2>MISSION CONTROL</h2>
    </div>

    <div id="app-dashboard">
        <div class="top-nav">
            <span id="network-status" class="status-badge online">ONLINE</span>
            <button id="theme-toggle" class="btn-header" onclick="toggleTheme()">üåô Mode</button>
            <button id="install-btn" class="btn-header">Install</button>
            <button class="logout-btn btn-header" onclick="logout()">Sign Out</button>
        </div>

        <div class="analytics-container">
            <div class="analytics-header">Weekly Progress</div>
            <div class="analytics-content">
                <div class="chart-area" id="weeklyChart"></div>
            </div>
        </div>

        <div class="input-bar">
            <input type="text" id="taskName" placeholder="Task Name...">
            <select id="taskCat">
                <option value="work">Work</option>
                <option value="home">Home</option>
                <option value="personal">Personal</option>
                <option value="urgent">Urgent</option>
            </select>
            <input type="date" id="taskDate">
            <button onclick="addTask()" style="background:var(--primary); color:white; border:none; padding:10px 20px; border-radius:10px; cursor:pointer;">DEPLOY</button>
        </div>

        <div class="board">
            <div class="col"><h3>PAST</h3><ul id="list-prev"></ul></div>
            <div class="col"><h3>TODAY</h3><ul id="list-today"></ul></div>
            <div class="col"><h3>FUTURE</h3><ul id="up-cont"></ul></div>
        </div>
    </div>

    <div id="auth-screen">
        <div class="auth-card">
            <h2 id="auth-title">Login</h2>
            <input type="text" id="username" class="auth-input" placeholder="Username">
            <input type="password" id="password" class="auth-input" placeholder="Password">
            <button id="authBtn" class="btn-login" onclick="handleAuth()">LOGIN</button>
            <p id="toggle-text" style="font-size:12px; margin-top:15px; cursor:pointer;" onclick="toggleAuthMode()">New? Sign Up</p>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA-mhIz79hzRvTbVZKeDPEfv2uv5jh-iSA",
        authDomain: "task-list-tracker-e80d4.firebaseapp.com",
        databaseURL: "https://task-list-tracker-e80d4-default-rtdb.asia-southeast1.firebasedatabase.app", 
        projectId: "task-list-tracker-e80d4",
        appId: "1:918246411240:web:3f448eb1d0a6fc3f4fb25d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentUser = null, allTasks = [], isLoginMode = true;

    // --- SERVICE WORKER INTEGRATION ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                reg.onupdatefound = () => {
                    const installingWorker = reg.installing;
                    installingWorker.onstatechange = () => {
                        if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            window.location.reload(); 
                        }
                    };
                };
            });
        });
    }

    // Network Status Tracker
    const updateOnlineStatus = () => {
        const el = document.getElementById('network-status');
        el.innerText = navigator.onLine ? 'ONLINE' : 'OFFLINE';
        el.className = `status-badge ${navigator.onLine ? 'online' : 'offline'}`;
    };
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);

    // Theme Logic
    window.toggleTheme = () => {
        const target = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', target);
        localStorage.setItem('mission-theme', target);
    };
    if(localStorage.getItem('mission-theme')) document.documentElement.setAttribute('data-theme', localStorage.getItem('mission-theme'));

    // Auth & Data
    onAuthStateChanged(auth, (user) => {
        document.getElementById('splash-screen').style.opacity = '0';
        setTimeout(() => document.getElementById('splash-screen').style.display = 'none', 500);
        if (user) {
            currentUser = user;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-dashboard').style.display = 'block';
            loadData();
        } else {
            document.getElementById('auth-screen').style.display = 'flex';
            document.getElementById('app-dashboard').style.display = 'none';
        }
    });

    window.handleAuth = async () => {
        const u = document.getElementById('username').value, p = document.getElementById('password').value;
        const email = `${u}@mission.com`;
        try {
            isLoginMode ? await signInWithEmailAndPassword(auth, email, p) : await createUserWithEmailAndPassword(auth, email, p);
        } catch (e) { alert(e.message); }
    };

    window.toggleAuthMode = () => {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "Login" : "Sign Up";
    };

    window.logout = () => signOut(auth);

    function loadData() {
        onValue(ref(db, `users/${currentUser.uid}/tasks`), (snap) => {
            const data = snap.val();
            allTasks = data ? Object.keys(data).map(k => ({id: k, ...data[k]})) : [];
            renderUI();
        });
    }

    window.addTask = () => {
        const n = document.getElementById('taskName').value, d = document.getElementById('taskDate').value, c = document.getElementById('taskCat').value;
        if(!n || !d) return;
        set(ref(db, `users/${currentUser.uid}/tasks/${Date.now()}`), { name: n, cat: c, date: d, completed: false });
        document.getElementById('taskName').value = '';
    };

    window.toggleTask = (id, cur) => update(ref(db, `users/${currentUser.uid}/tasks/${id}`), { completed: !cur });
    window.deleteTask = (id) => remove(ref(db, `users/${currentUser.uid}/tasks/${id}`));

    function renderUI() {
        const today = new Date().toISOString().split('T')[0];
        const lists = { prev: document.getElementById('list-prev'), now: document.getElementById('list-today'), up: document.getElementById('up-cont') };
        Object.values(lists).forEach(l => l.innerHTML = '');

        allTasks.forEach(t => {
            const li = document.createElement('li');
            li.style.borderLeftColor = `var(--cat-${t.cat})`;
            li.innerHTML = `<span><input type="checkbox" ${t.completed?'checked':''} onchange="toggleTask('${t.id}',${t.completed})"> ${t.name}</span>
                            <button onclick="deleteTask('${t.id}')" style="background:none; border:none; cursor:pointer;">üóëÔ∏è</button>`;
            
            if (t.date < today) lists.prev.appendChild(li);
            else if (t.date === today) lists.now.appendChild(li);
            else lists.up.appendChild(li);
        });

        // Simple Chart Rendering
        const chart = document.getElementById('weeklyChart');
        chart.innerHTML = '';
        for(let i=0; i<7; i++) {
            const dayBar = document.createElement('div');
            dayBar.className = 'bar-track';
            dayBar.innerHTML = `<div class="bar-done" style="height:${Math.random()*100}%"></div>`; // Mock logic for visual
            chart.appendChild(dayBar);
        }
    }
</script>
</body>
</html>
